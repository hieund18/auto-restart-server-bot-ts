ÄÃ¢y lÃ  cÃ¡c bÆ°á»›c chi tiáº¿t báº¡n cáº§n lÃ m trÃªn server.

-----

## 1\. CÃ i Ä‘áº·t MÃ´i trÆ°á»ng âš™ï¸

Báº¡n cáº§n cÃ i Ä‘áº·t **Node.js** vÃ  **`forever`** trÃªn server cá»§a mÃ¬nh.

1.  **CÃ i Ä‘áº·t Node.js:** (Náº¿u báº¡n chÆ°a cÃ³). TÃ´i khuyÃªn dÃ¹ng Node.js 18.x. Báº¡n cÃ³ thá»ƒ cÃ i Ä‘áº·t nÃ³ qua `nvm` (Node Version Manager) hoáº·c trÃ¬nh quáº£n lÃ½ gÃ³i cá»§a há»‡ Ä‘iá»u hÃ nh.
2.  **CÃ i Ä‘áº·t `forever`:** `forever` lÃ  má»™t gÃ³i npm, báº¡n nÃªn cÃ i nÃ³ á»Ÿ cháº¿ Ä‘á»™ "toÃ n cá»¥c" (global):
    ```bash
    npm install -g forever
    ```

-----

## 2\. Chuáº©n bá»‹ Code ğŸšš

1.  **Táº£i Code:** Táº£i toÃ n bá»™ thÆ° má»¥c dá»± Ã¡n TypeScript (`my-ts-bot` vá»›i `src/index.ts`, `package.json`, v.v.) lÃªn server cá»§a báº¡n. (Báº¡n cÃ³ thá»ƒ dÃ¹ng `git clone` hoáº·c `scp`).
2.  **Di chuyá»ƒn vÃ o thÆ° má»¥c:**
    ```bash
    cd /duong/dan/den/my-ts-bot
    ```
3.  **CÃ i Ä‘áº·t Dependencies:** Cháº¡y lá»‡nh nÃ y Ä‘á»ƒ cÃ i Ä‘áº·t `telegraf`, `axios`, v.v. (nhá»¯ng thÆ° viá»‡n Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trong `package.json`).
    ```bash
    npm install
    ```

-----

## 3\. BiÃªn dá»‹ch TypeScript ğŸ› ï¸

`forever` (giá»‘ng nhÆ° Node.js) khÃ´ng thá»ƒ cháº¡y trá»±c tiáº¿p file TypeScript (`.ts`). Báº¡n pháº£i *biÃªn dá»‹ch* nÃ³ sang JavaScript (`.js`) trÆ°á»›c.

1.  Cháº¡y lá»‡nh build Ä‘Ã£ Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trong `package.json`:
    ```bash
    npm run build
    ```
2.  Lá»‡nh nÃ y sáº½ Ä‘á»c file `tsconfig.json` vÃ  táº¡o má»™t thÆ° má»¥c má»›i lÃ  `dist`, bÃªn trong chá»©a file `index.js` Ä‘Ã£ Ä‘Æ°á»£c biÃªn dá»‹ch. ÄÃ¢y chÃ­nh lÃ  file mÃ  `forever` sáº½ cháº¡y.

-----

## 4\. Sá»­a Ä‘Æ°á»ng dáº«n File JSON (Ráº¥t quan trá»ng) âš ï¸

Trong code TypeScript (`src/index.ts`), báº¡n Ä‘ang lÆ°u file user á»Ÿ:
`const USERS_FILE = '/data/authorized_users.json';`

ÄÆ°á»ng dáº«n `/data` nÃ y lÃ  dÃ nh cho Docker. Khi cháº¡y trá»±c tiáº¿p, nÃ³ sáº½ cá»‘ gáº¯ng ghi vÃ o thÆ° má»¥c gá»‘c `/data` cá»§a server, Ä‘iá»u nÃ y cÃ³ thá»ƒ gÃ¢y lá»—i (hoáº·c khÃ´ng pháº£i lÃ  nÆ¡i báº¡n muá»‘n).

**Báº¡n cáº§n sá»­a láº¡i nhÆ° sau:**

1.  Má»Ÿ file `src/index.ts` Ä‘á»ƒ chá»‰nh sá»­a.
2.  TÃ¬m dÃ²ng:
    `const USERS_FILE = '/data/authorized_users.json';`
3.  Sá»­a nÃ³ thÃ nh Ä‘Æ°á»ng dáº«n tÆ°Æ¡ng Ä‘á»‘i (vÃ­ dá»¥: lÆ°u vÃ o má»™t thÆ° má»¥c `data` ngay trong thÆ° má»¥c dá»± Ã¡n cá»§a báº¡n):
    `const USERS_FILE = './data/authorized_users.json';`
4.  **Ráº¥t quan trá»ng:** Sau khi sá»­a code, báº¡n pháº£i **biÃªn dá»‹ch láº¡i**:
    ```bash
    npm run build
    ```

-----

## 5\. Cáº¥u hÃ¬nh Biáº¿n MÃ´i trÆ°á»ng ğŸ”‘

Bot cá»§a báº¡n (file `index.ts`) sá»­ dá»¥ng `dotenv` Ä‘á»ƒ tá»± Ä‘á»™ng Ä‘á»c file `.env`. Báº¡n chá»‰ cáº§n táº¡o file Ä‘Ã³.

1.  Táº¡o file `.env` ngay táº¡i thÆ° má»¥c gá»‘c cá»§a dá»± Ã¡n (cÃ¹ng chá»— vá»›i `package.json`).
2.  DÃ¡n toÃ n bá»™ ná»™i dung bÃ­ máº­t cá»§a báº¡n vÃ o file `.env`:
    ```env
    TELEGRAM_TOKEN=8263386648:AAG8lgwHKU0GOdWAuHDbTO-pzsxZThsjVEg
    SUPER_ADMIN_ID=6474818030
    JENKINS_URL=http://10.168.3.144:8089
    JENKINS_USER=his
    JENKINS_TOKEN=110e1554ba51d9f29c5d697684ddbfad06
    JENKINS_JOB=RESTART_HISTEST
    ```

File `index.js` (trong `dist`) sáº½ tá»± Ä‘á»™ng Ä‘á»c cÃ¡c biáº¿n nÃ y khi nÃ³ cháº¡y.

-----

## 6\. Cháº¡y Bot báº±ng `forever` ğŸš€

BÃ¢y giá», má»i thá»© Ä‘Ã£ sáºµn sÃ ng.

1.  **Khá»Ÿi Ä‘á»™ng Bot:**
    Cháº¡y `forever` vÃ  trá» nÃ³ Ä‘áº¿n file JavaScript Ä‘Ã£ Ä‘Æ°á»£c biÃªn dá»‹ch:
    ```bash
    forever start dist/index.js
    ```
2.  **Kiá»ƒm tra Tráº¡ng thÃ¡i:**
    Xem danh sÃ¡ch cÃ¡c tiáº¿n trÃ¬nh Ä‘ang cháº¡y:
    ```bash
    forever list
    ```
    Báº¡n sáº½ tháº¥y má»™t tiáº¿n trÃ¬nh `dist/index.js` vá»›i má»™t `id` (vÃ­ dá»¥: `[0]`).

### CÃ¡c lá»‡nh `forever` há»¯u Ã­ch:

  * **Xem log (nháº­t kÃ½) cá»§a bot:**
    (Náº¿u `id` cá»§a bot lÃ  `0`)

    ```bash
    forever logs 0 -f
    ```

    (Nháº¥n `Ctrl+C` Ä‘á»ƒ dá»«ng xem log).

  * **Dá»«ng bot:**

    ```bash
    forever stop 0
    ```

  * **Khá»Ÿi Ä‘á»™ng láº¡i bot:**

    ```bash
    forever restart 0
    ```

  * **Dá»«ng táº¥t cáº£:**

    ```bash
    forever stopall
    ```